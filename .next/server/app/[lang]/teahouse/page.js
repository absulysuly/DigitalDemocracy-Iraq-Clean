(()=>{var e={};e.id=354,e.ids=[354],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44096:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>g,tree:()=>d}),a(63613),a(59282),a(53956),a(56033),a(11506),a(26083),a(35866);var r=a(23191),n=a(88716),o=a(37922),i=a.n(o),s=a(95231),l={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>s[e]);a.d(t,l);let d=["",{children:["[lang]",{children:["teahouse",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,63613)),"E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\[lang]\\teahouse\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,59282)),"E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\[lang]\\layout.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,53956)),"E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\[lang]\\loading.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,56033)),"E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\[lang]\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,11506)),"E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,26083)),"E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\HamletUnified\\Copy-of-Hamlet-social\\app\\[lang]\\teahouse\\page.tsx"],u="/[lang]/teahouse/page",p={require:a,loadChunk:()=>Promise.resolve()},g=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/[lang]/teahouse/page",pathname:"/[lang]/teahouse",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},36048:(e,t,a)=>{Promise.resolve().then(a.bind(a,2583))},2583:(e,t,a)=>{"use strict";a.d(t,{default:()=>p});var r=a(10326),n=a(17577),o=a(88129),i=a(30058);let s=({title:e,subtitle:t})=>(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-iraq-red via-iraq-white to-iraq-green p-8 rounded-2xl text-center my-6",children:[r.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2 font-arabic",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.1)"},children:e}),r.jsx("p",{className:"text-gray-700",children:t})]});var l=a(62881);let d=(0,l.Z)("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]),c=(0,l.Z)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);async function u(e,t,a,r){let n=new Int16Array(e.buffer),o=n.length/r,i=t.createBuffer(r,o,a);for(let e=0;e<r;e++){let t=i.getChannelData(e);for(let a=0;a<o;a++)t[a]=n[a*r+e]/32768}return i}function p({dictionary:e}){let[t,a]=(0,n.useState)("disconnected"),[l,p]=(0,n.useState)([]),[g,m]=(0,n.useState)(!1),h=(0,n.useRef)(null),x=(0,n.useRef)(null),f=(0,n.useRef)(null),y=(0,n.useRef)(null),v=(0,n.useRef)(new Set).current,b=0,w=(0,n.useCallback)(()=>{h.current&&(h.current.then(e=>e.close()),h.current=null),x.current&&(x.current.getTracks().forEach(e=>e.stop()),x.current=null),y.current&&(y.current.disconnect(),y.current=null),f.current&&"closed"!==f.current.state&&f.current.close(),v.forEach(e=>e.stop()),v.clear(),a("disconnected")},[v]),j=async()=>{if(!g&&!h.current){a("connecting");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Your browser does not support audio recording."),a("error");return}x.current=await navigator.mediaDevices.getUserMedia({audio:!0});let e=new GoogleGenAI({apiKey:process.env.NEXT_PUBLIC_API_KEY}),t=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});f.current=t;let r=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3});h.current=e.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",config:{responseModalities:[Modality.AUDIO],inputAudioTranscription:{},outputAudioTranscription:{},systemInstruction:"You are a friendly and knowledgeable host at a digital Iraqi tea house (Diwan). Your goal is to foster positive and engaging conversations about civic life, community, and the future. Keep your responses concise, warm, and encouraging. Your name is Naseem."},callbacks:{onopen:()=>{a("connected");let e=t.createMediaStreamSource(x.current),r=t.createScriptProcessor(4096,1,1);y.current=r,r.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),a=function(e){let t=e.length,a=new Int16Array(t);for(let r=0;r<t;r++)a[r]=32768*e[r];return{data:function(e){let t="",a=e.byteLength;for(let r=0;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}(new Uint8Array(a.buffer)),mimeType:"audio/pcm;rate=16000"}}(t);h.current?.then(e=>{e.sendRealtimeInput({media:a})})},e.connect(r),r.connect(t.destination)},onmessage:async e=>{if(e.serverContent?.inputTranscription){let{text:t,isFinal:a}=e.serverContent.inputTranscription;p(e=>{let r=e[e.length-1];return r&&"user"===r.author&&!r.isFinal?[...e.slice(0,-1),{...r,text:t,isFinal:a}]:[...e,{id:Date.now(),text:t,author:"user",isFinal:a}]})}if(e.serverContent?.outputTranscription){let{text:t,isFinal:a}=e.serverContent.outputTranscription;p(e=>{let r=e[e.length-1];return r&&"model"===r.author&&!r.isFinal?[...e.slice(0,-1),{...r,text:t,isFinal:a}]:[...e,{id:Date.now(),text:t,author:"model",isFinal:a}]})}if(e.serverContent?.modelTurn?.parts[0]?.inlineData?.data){let t=e.serverContent.modelTurn.parts[0].inlineData.data;b=Math.max(b,r.currentTime);let a=await u(function(e){let t=atob(e),a=t.length,r=new Uint8Array(a);for(let e=0;e<a;e++)r[e]=t.charCodeAt(e);return r}(t),r,24e3,1),n=r.createBufferSource();n.buffer=a,n.connect(r.destination),n.addEventListener("ended",()=>v.delete(n)),n.start(b),b+=a.duration,v.add(n)}},onerror:e=>{console.error("Session error:",e),a("error"),w()},onclose:e=>{w()}}})}catch(e){console.error("Failed to start session:",e),a("error"),w()}}},k="connected"===t||"connecting"===t,C={disconnected:{text:e.page.teahouse.disconnected,color:"bg-gray-500"},connecting:{text:e.page.teahouse.connecting,color:"bg-yellow-500 animate-pulse"},connected:{text:e.page.teahouse.connected,color:"bg-green-500"},error:{text:g?"Service Unavailable":e.page.teahouse.error,color:"bg-red-500"}};return(0,r.jsxs)("div",{className:"container mx-auto max-w-3xl px-4 py-8",children:[r.jsx(s,{title:e.page.teahouse.title,subtitle:e.page.teahouse.description}),(0,r.jsxs)("div",{className:"relative overflow-hidden rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-800",children:[r.jsx("div",{className:"absolute inset-0 -z-0 bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900/50 dark:via-gray-800 dark:to-gray-900/30"}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`h-3 w-3 rounded-full ${C[t].color}`}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:C[t].text})]}),"connected"===t&&r.jsx("p",{className:"animate-pulse text-sm text-green-600 dark:text-green-400",children:e.page.teahouse.speakNow})]}),r.jsx("div",{className:"scrollbar-hide mb-6 h-80 space-y-4 overflow-y-auto rounded-lg bg-gray-50 p-4 dark:bg-gray-900/50",children:r.jsx(o.M,{children:l.map(e=>r.jsx(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},layout:!0,className:`flex ${"user"===e.author?"justify-end":"justify-start"}`,children:r.jsx("div",{className:`max-w-xs rounded-2xl px-4 py-2 md:max-w-md ${"user"===e.author?"rounded-br-none bg-green-100 dark:bg-green-900/50":"rounded-bl-none bg-gray-200 dark:bg-gray-700"}`,children:r.jsx("p",{className:`text-gray-800 dark:text-gray-200 ${e.isFinal?"":"opacity-70"}`,children:e.text})})},e.id))})}),r.jsx("div",{className:"flex justify-center",children:(0,r.jsxs)(i.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:k?w:j,className:`flex items-center gap-3 rounded-full px-8 py-4 font-bold text-white transition-all disabled:cursor-not-allowed disabled:bg-gray-400 disabled:shadow-none ${k?"bg-red-600 hover:bg-red-700 shadow-[0_0_20px_theme(colors.red.400)]":"bg-green-600 hover:bg-green-700 shadow-lg"}`,animate:k?{scale:[1,1.05,1]}:{},transition:k?{repeat:1/0,duration:2,ease:"easeInOut"}:{},disabled:"connecting"===t||g,children:[k?r.jsx(d,{}):r.jsx(c,{}),r.jsx("span",{children:k?e.page.teahouse.leave:e.page.teahouse.join})]})})]})]})]})}},63613:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s,generateMetadata:()=>i});var r=a(19510),n=a(88483);let o=(0,a(68570).createProxy)(String.raw`E:\HamletUnified\Copy-of-Hamlet-social\components\views\TeaHouseView.tsx#default`);async function i({params:{lang:e}}){let t=await (0,n.R)(e);return{title:`${t.page.teahouse.title} | ${t.metadata.title}`,description:t.page.teahouse.description}}async function s({params:{lang:e}}){let t=await (0,n.R)(e);return r.jsx(o,{dictionary:t})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[740,527,796],()=>a(44096));module.exports=r})();